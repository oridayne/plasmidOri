<!DOCTYPE html>
<html>
    <head>
        <script src='javascript/angular.1.6.9.min.js'></script>
        <script src='javascript/angularplasmid.min.js'></script>
        <link rel="stylesheet" href="style/pstyle.css">
        <link rel="stylesheet" href="style/ppage.css">
        <script src="javascript/jquery.2.1.3.min.js" type="text/javascript"></script> 
        <script src="javascript/d3.v3.min.js" type="text/javascript"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="javascript/blastAPI.js" type="text/javascript"></script>
        <script src="javascript/pscript.js" type="text/javascript"></script>
        <script src="javascript/editor.js" type="text/javascript"></script>
        <script src="javascript/plasmidGrab.js" type="text/javascript"></script>
        <link rel="stylesheet" href="style/editor.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
        <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"> -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>



    </head>
    <body ng-app="myApp">

        
        <div  ng-controller="myCtrl" id="divider" >
            <div id="display">

                <plasmid id='p1' sequencelength='{{seq.length}}'>
                    <plasmidtrack   radius="{{myRad}}"  id='t1' transform="translate(100,100)">

                        <!-- ticks -->
                        <trackscale  id="innerticks" class='smajor' interval='{{interval}}' showlabels='1' labelclass='sml'></trackscale>

                        <!-- user annotations       -->
                        <trackmarker class="highlight" ng-repeat='n in annotations' start='{{n.start}}' end='{{n.end}}' ng-click="toggle('annotate'); setAnnotatePoints(n.start, n.end, n.name); focusAnnotation(n.start,n.end);"  ></trackmarker>
                        
                        <!-- search results -->
                        <trackmarker   markerclass="markerhover" markerstyle="fill:rgba(128,0,0,0.2)" ng-repeat='n in searchResults' start='{{n.start}}' end='{{n.end}}' vadjust="25"  ng-click="viewSearch(n.start,n.end) "></trackmarker>

                        <!-- ORFS -->
                        <trackmarker ng-repeat='n in orfsdata' markerclass="orfhover" ng-click="viewORF(n[0],n[1]); toggle('orf');"  start="{{n[0]}}" end="{{n[1]}}"  vadjust="-20" wadjust="-23" arrowstartlength="0.8" arrowstartwidth="10" arrowendlength="5" arrowendwidth="3"></trackmarker>
                        
                        <!-- blast matches -->
                        <trackmarker markerclass="blastmarker"  start="{{blastMatch[0]}}" end="{{blastMatch[1]}}"  vadjust="-5" wadjust="-23" ></trackmarker>

                        <!-- drawing arc forward -->
                        <trackmarker markerclass="markerhover" ng-if="ed!=false && start<end" start="{{start}}" end="{{end}}" ng-click="toggle('viewer')" ng-dblclick="reset();" vadjust="25" markerstyle="fill:rgba(0,128,0,0.2)" wadjust=""></trackmarker>

                        <!-- drawing arc backward -->
                        <trackmarker markerclass="markerhover"  ng-click="toggle('viewer')" ng-dblclick="reset()" ng-if="ed!=false && start>end" start="{{end}}" end="{{start}}"  vadjust="25" markerstyle="fill:rgba(0,128,0,0.2)" wadjust=""></trackmarker>

                    </plasmidtrack>
                </plasmid>
                <div id="control">
                    <!-- control panel for dna editing -->
                    <div id="controlDNA" class="panel">
                        <div class="sideInfo">
                            
                            <p>Sequence Length:{{seq.length}}</p>
                            <p>ORF Minimum Length:<input type="number" id="orf" class="viewControl" ng-keydown="editOrfMinLength($event)" value={{minLength}}></p>
                            <p>tick interval:<input id="interval" class="viewControl" ng-keydown="editInterval($event)" type="number" value={{interval}}></p>
                        </div>

                    </div>
                </div>
            </div>
           
            <div id="editor" >
                
                    <div id="dna" class="item active" ng-click="toggle('dna')"><p>DNA</p></div>
                    <div id="viewer" class="item" ng-click="toggle('viewer')"><p>Viewer</p></div>
                    <div id="blast" class="item" ng-click="toggle('blast')"><p>Blast Align</p></div>

                <div id="content">

                    <!-- content for dna editing -->
                     <div ng-show="selected=='viewer'||selected=='orf'||selected=='dna'||selected=='annotate'||selected=='search'" id="controlDNA" >
                    <!-- content for viewing annotations -->
                    <div ng-show="selected=='annotate'">
                        <input id="name" ng-click="editName()" ng-keydown="editKeys($event)" class="editFocus" ng-model="annotateName" readonly>
                        <button class="btn" ng-click="removeAnnotation(annotateStart, annotateEnd)">Remove Annotation</button>
                        <button class="btn" ng-click="removeAnnotation(annotateStart, annotateEnd);deleteAnnotation(annotateStart, annotateEnd); orfsFunc();">Delete Sequence</button>
                    </div>
                     <textarea type="text" placeholder="Search.." id="searchDNA" ng-model="search"></textarea>
                        <button ng-click="searchDNA();" id="searchbutton">Go!</button><button ng-click="clear()">Clear</button>
                       <div ng-include="'javascript/editor.html'"></div>
                       <button ng-show="selected=='viewer'" id="annotateButton" ng-click="annotate(start, end);">Annotate</button>
                    </div>

                    <div ng-show="selected=='blast'">
                        <div id="blastWrapper">

                            <div ng-show="rid!=false">{{rid}}</div>
                            <div id="hspList">
                                <!-- wrapper -->
                                <div ng-repeat="x in hspList" class="blastHSP" ng-click="setBlast(x.hfrom, x.hto)">
                                    <!-- header -->
                                    <div>
                                        <strong>Range {{x.num}}: {{x.hfrom}} to {{x.hto}}</strong>
                                        <br>
                                        Score = {{x["bitscore"]}} bits ({{x.score}}), Expect={{x.expect}}<br>
                                        Identities={{x.identities}}/{{x.align}} ({{((x.identities/x.align)*100).toFixed(0)}}%), Gaps = {{x.gaps}}/{{x.align}} ({{((x.gaps/x.align)*100).toFixed(0)}}%)
                                    </div>
                                    <!-- left indice -->
                                    <div class="blastStyle">
                                        <div class="blastIndex">
                                            <div ng-repeat="indice in x.leftIndices">
                                                Query {{indice[0]}} <br><br>
                                                Sbjct {{indice[1]}} <br><br>
                                            </div>
                                        </div>

                                        <!-- info -->
                                        <div>
                                            <div ng-repeat="i in x.seqs">
                                                    <div>{{i[0]}}</div>
                                                    <div>{{i[1]}}</div>
                                                    <div>{{i[2]}}</div>
                                                <br>
                                            </div>
                                        </div>

                                        <!-- right indice -->
                                        <div class="blastIndex">
                                            <div ng-repeat="rightIndex in x.rightIndices">
                                                {{rightIndex[0]}} <br><br>
                                                {{rightIndex[1]}} <br><br>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>    

    </body>
</html>

